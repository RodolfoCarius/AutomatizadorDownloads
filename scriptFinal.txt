#!/bin/bash

validaAno=true
validaMes=true
validaDia=true
echo "Por favor, insira o ano (YYYY) de 2015 para cima:"
read ANO
while $validaAno; do
if ! [[ $ANO =~ ^[0-9]{4}$ ]]; then
    echo "Ano inválido. Por favor, insira um ano com 4 dígitos e apartir de 2015."
    read ANO
elif [ $ANO -lt 2015 ];then
echo "Ano inválido. O ano deve ser a partir de 2015."
read ANO
    else
    validaAno=false
fi
done

echo "Por favor, insira o mês (MM):"
read MES

while $validaMes; do
if ! [[ $MES =~ ^[0-9]{2}$ ]]; then
        echo "Mês inválido. Por favor, insira um mês (MM)."
        read MES
elif [ $MES -lt 1 ] || [ $MES -gt 12 ]; then
echo "Mês inválido. Por favor, insira um mês entre 01 e 12."
read MES
    else
    validaMes=false
fi
done

echo "Por favor insira o dia (DD):"
read DIA

while $validaDia; do
if ! [[ $DIA =~ ^[0-9]{2}$ ]] || [ $DIA -lt 1 ] || [ $DIA -gt 31 ]; then
        echo "Dia inválido. Por favor, insira um dia entre 01 e 31."
        read DIA
    else
    validaDia=false
fi
done


BASE_URL="https://gz.blockchair.com/ethereum/blocks/blockchair_ethereum_blocks_"

DEST_DIR="./downloads/${ANO}/${MES}"
mkdir -p $DEST_DIR

#for DIA in {01..31}; do
    URL="${BASE_URL}${ANO}${MES}${DIA}.tsv.gz"

    ARQUIVO="${DEST_DIR}/blocks_${ANO}${MES}${DIA}.tsv.gz"

        echo "Baixando: $URL"

        wget -O $ARQUIVO $URL
        if [ $? -eq 0 ]; then
            echo "Download de ${ARQUIVO} concluído com sucesso!"
        else
            echo "Ocorreu um erro durante o download de ${ARQUIVO}."
        fi

#done

echo "Todos os downloads foram concluídos!"